name: C/C++ CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on: ubuntu-latest
    container: centos:7

    steps:
    - name: Fix mirrors list
      run: |
        sed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-*
        sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-*
    - name: Install packages
      run: yum install -y git gcc make nim libclamav-static-devel libyara-devel
    - name: Get RkCheck
      run: |
        git clone https://github.com/dmknght/rkcheck
        cd rkcheck
    - name: build
      run: make build
